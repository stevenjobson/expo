{"version":3,"file":"ExpoImage.web.js","sourceRoot":"","sources":["../src/ExpoImage.web.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\n\nimport {\n  ImageContentPositionObject,\n  ImageContentPositionValue,\n  ImageNativeProps,\n  ImageProps,\n  ImageSource,\n  ImageLoadEventData,\n} from './Image.types';\nimport { useBlurhash } from './utils/blurhash/useBlurhash';\nimport { isBlurhashString } from './utils/resolveSources';\n\nfunction ensureUnit(value: string | number) {\n  const trimmedValue = String(value).trim();\n  if (trimmedValue.endsWith('%')) {\n    return trimmedValue;\n  }\n  return `${trimmedValue}px`;\n}\n\ntype KeysOfUnion<T> = T extends T ? keyof T : never;\n\nfunction getObjectPositionFromContentPositionObject(\n  contentPosition?: ImageContentPositionObject\n): string {\n  const resolvedPosition = { ...contentPosition } as Record<\n    KeysOfUnion<ImageContentPositionObject>,\n    ImageContentPositionValue\n  >;\n  if (!resolvedPosition) {\n    return '50% 50%';\n  }\n  if (resolvedPosition.top == null && resolvedPosition.bottom == null) {\n    resolvedPosition.top = '50%';\n  }\n  if (resolvedPosition.left == null && resolvedPosition.right == null) {\n    resolvedPosition.left = '50%';\n  }\n\n  return (\n    ['top', 'bottom', 'left', 'right']\n      .map((key) => {\n        if (key in resolvedPosition) {\n          return `${key} ${ensureUnit(resolvedPosition[key])}`;\n        }\n        return '';\n      })\n      .join(' ') || '50% 50%'\n  );\n}\n\nfunction findBestSourceForSize(\n  sources: ImageSource[] | undefined,\n  size: DOMRect | null\n): ImageSource | null {\n  return (\n    [...(sources || [])]\n      // look for the smallest image that's still larger then a container\n      ?.map((source) => {\n        if (!size) {\n          return { source, penalty: 0, covers: false };\n        }\n        const { width, height } =\n          typeof source === 'object' ? source : { width: null, height: null };\n        if (width == null || height == null) {\n          return { source, penalty: 0, covers: false };\n        }\n        if (width < size.width || height < size.height) {\n          return {\n            source,\n            penalty: Math.max(size.width - width, size.height - height),\n            covers: false,\n          };\n        }\n        return { source, penalty: (width - size.width) * (height - size.height), covers: true };\n      })\n      .sort((a, b) => a.penalty - b.penalty)\n      .sort((a, b) => Number(b.covers) - Number(a.covers))[0]?.source ?? null\n  );\n}\n\nfunction useSourceSelection(\n  sources?: ImageSource[],\n  sizeCalculation: ImageProps['responsivePolicy'] = 'live'\n) {\n  const hasMoreThanOneSource = (sources?.length ?? 0) > 1;\n\n  // null - not calculated yet, DOMRect - size available\n  const [size, setSize] = React.useState<null | DOMRect>(null);\n  const resizeObserver = React.useRef<ResizeObserver | null>(null);\n\n  React.useEffect(() => {\n    return () => {\n      resizeObserver.current?.disconnect();\n    };\n  }, []);\n\n  const containerRef = React.useCallback(\n    (element: HTMLDivElement) => {\n      if (!hasMoreThanOneSource) {\n        return;\n      }\n      setSize(element?.getBoundingClientRect());\n      if (sizeCalculation === 'live') {\n        resizeObserver.current?.disconnect();\n        if (!element) {\n          return;\n        }\n        resizeObserver.current = new ResizeObserver((entries) => {\n          setSize(entries[0].contentRect);\n        });\n        resizeObserver.current.observe(element);\n      }\n    },\n    [hasMoreThanOneSource, sizeCalculation]\n  );\n\n  const bestSourceForSize = size !== undefined ? findBestSourceForSize(sources, size) : null;\n  const source = (hasMoreThanOneSource ? bestSourceForSize : sources?.[0]) ?? null;\n\n  return React.useMemo(\n    () => ({\n      containerRef,\n      source,\n    }),\n    [source]\n  );\n}\n\nfunction getFetchPriorityFromImagePriority(priority: ImageNativeProps['priority'] = 'normal') {\n  return priority && ['low', 'high'].includes(priority) ? priority : 'auto';\n}\n\nfunction setClassOnElement(element: HTMLImageElement | null, classes: string[]) {\n  if (!element) {\n    return;\n  }\n  element.setAttribute('class', classes.join(' '));\n}\n\nfunction getAnimatorFromClass(animationClass: string | null) {\n  if (!animationClass) return null;\n  return {\n    startingClass: `${animationClass}-start`,\n    run: (to: React.RefObject<HTMLImageElement>, from: React.RefObject<HTMLImageElement>[]) => {\n      setClassOnElement(to.current, [animationClass, 'transitioning', `${animationClass}-active`]);\n      from.forEach((element) => {\n        if (!element.current?.classList.contains(`unmount`)) {\n          setClassOnElement(element.current, [animationClass, `${animationClass}-end`, 'unmount']);\n        }\n      });\n    },\n  };\n}\n\nconst Image = React.forwardRef(\n  (\n    {\n      source,\n      events,\n      contentPosition,\n      blurhashContentPosition,\n      priority,\n      style,\n      blurhashStyle,\n      className,\n    }: {\n      source?: ImageSource | null;\n      events?: {\n        onLoad?: (((event: React.SyntheticEvent<HTMLImageElement, Event>) => void) | undefined)[];\n        onError?: ((({ source }: { source: ImageSource | null }) => void) | undefined)[];\n        onTransitionEnd?: ((() => void) | undefined)[];\n        onMount?: ((() => void) | undefined)[];\n      };\n      contentPosition?: ImageContentPositionObject;\n      blurhashContentPosition?: ImageContentPositionObject;\n      priority?: string | null;\n      style: React.CSSProperties;\n      blurhashStyle?: React.CSSProperties;\n      className?: string;\n    },\n    ref: React.Ref<HTMLImageElement>\n  ) => {\n    React.useEffect(() => {\n      events?.onMount?.forEach((e) => e?.());\n    }, []);\n\n    const isBlurhash = isBlurhashString(source?.uri || '');\n    const blurhashUri = useBlurhash(isBlurhash ? source?.uri : null, source?.width, source?.height);\n    const objectPosition = getObjectPositionFromContentPositionObject(\n      isBlurhash ? blurhashContentPosition : contentPosition\n    );\n    const uri = isBlurhash ? blurhashUri : source?.uri;\n\n    return (\n      <img\n        ref={ref}\n        className={className}\n        src={uri || undefined}\n        key={source?.uri}\n        style={{\n          width: '100%',\n          height: '100%',\n          position: 'absolute',\n          left: 0,\n          right: 0,\n          objectPosition,\n          ...style,\n          ...(isBlurhash ? blurhashStyle : {}),\n        }}\n        // @ts-ignore\n        // eslint-disable-next-line react/no-unknown-property\n        fetchpriority={getFetchPriorityFromImagePriority(priority || 'normal')}\n        onLoad={(event) => {\n          events?.onLoad?.forEach((e) => e?.(event));\n        }}\n        onTransitionEnd={() => events?.onTransitionEnd?.forEach((e) => e?.())}\n        onError={() => events?.onError?.forEach((e) => e?.({ source: source || null }))}\n      />\n    );\n  }\n);\n\nfunction onLoadAdapter(onLoad?: (event: ImageLoadEventData) => void) {\n  return (event: React.SyntheticEvent<HTMLImageElement, Event>) => {\n    const target = event.target as HTMLImageElement;\n    onLoad?.({\n      source: {\n        url: target.currentSrc,\n        width: target.naturalWidth,\n        height: target.naturalHeight,\n        mediaType: null,\n      },\n      cacheType: 'none',\n    });\n  };\n}\n\nfunction onErrorAdapter(onError?: { (event: { error: string }): void }) {\n  return ({ source }: { source?: ImageSource | null }) => {\n    onError?.({\n      error: `Failed to load image from url: ${source?.uri}`,\n    });\n  };\n}\n\nfunction useAnimationManagerNode(node: AnimationManagerNode | null) {\n  const callbackContainer: {\n    onReady: (() => void) | null;\n    onAnimationFinished: (() => void) | null;\n    onMount: (() => void) | null;\n  } = {\n    onReady: null,\n    onAnimationFinished: null,\n    onMount: null,\n  };\n  const newNode = React.useMemo(() => {\n    console.log({ node });\n    if (!node) {\n      return null;\n    }\n    const [animationKey, renderFunction] = node;\n    const ref = React.createRef<HTMLImageElement>();\n    const child = renderFunction({\n      onReady: () => {\n        callbackContainer.onReady?.();\n      },\n      onAnimationFinished: () => {\n        callbackContainer.onAnimationFinished?.();\n      },\n      onMount: () => {\n        callbackContainer.onMount?.();\n      },\n      ref,\n    });\n    // key, ReactElement, ref, callbacks\n    return [animationKey, child, ref, callbackContainer] as [\n      string,\n      React.ReactElement,\n      React.RefObject<HTMLImageElement>,\n      typeof callbackContainer\n    ];\n  }, [node?.[1]]);\n  return newNode;\n}\n\ntype AnimationManagerNode = [\n  key: string,\n  renderFunction: (callbacks: {\n    onReady: () => void;\n    onAnimationFinished: () => void;\n    onMount: () => void;\n    ref: React.RefObject<HTMLImageElement>;\n  }) => React.ReactElement\n];\n\ntype Animation = null | {\n  run: (to: React.RefObject<HTMLImageElement>, from: React.RefObject<HTMLImageElement>[]) => void;\n  startingClass: string;\n};\n\nfunction AnimationManager({\n  children: renderFunction,\n  initial,\n  animation,\n}: {\n  children: AnimationManagerNode;\n  initial: AnimationManagerNode | null;\n  animation: null | Animation;\n}) {\n  const initialNode = useAnimationManagerNode(initial);\n  if (initialNode) {\n    initialNode[3].onAnimationFinished = () =>\n      setNodes((n) =>\n        n.filter((node, index) => node[0] !== initialNode[0] || index === n.length - 1)\n      );\n  }\n\n  const [nodes, setNodes] = React.useState<\n    [\n      string,\n      React.ReactElement,\n      React.RefObject<HTMLImageElement>,\n      {\n        onReady: (() => void) | null;\n        onAnimationFinished: ((forceUnmount?: boolean) => void) | null;\n        onMount: (() => void) | null;\n      }\n    ][]\n  >(initialNode ? [initialNode] : []);\n  const newNode = useAnimationManagerNode(renderFunction);\n  if (newNode) {\n    newNode[3].onAnimationFinished = (forceUnmount = false) => {\n      if (newNode[2].current?.classList.contains('unmount') || forceUnmount) {\n        setNodes((n) =>\n          n.filter((node, index) => node[0] !== newNode[0] || index === n.length - 1)\n        );\n      }\n    };\n  }\n  React.useEffect(() => {\n    setNodes((n) => {\n      if (!newNode) {\n        return n;\n      }\n      const existingNodeIndex = n.findIndex((node) => node[0] === newNode[0]);\n\n      if (existingNodeIndex >= 0) {\n        const copy = [...n];\n        copy.splice(existingNodeIndex, 1, newNode);\n        return copy;\n      }\n\n      newNode[3].onMount = () => {\n        if (!newNode?.[2].current || !animation?.startingClass) {\n          return;\n        }\n        setClassOnElement(newNode?.[2].current, [animation?.startingClass]);\n      };\n\n      newNode[3].onReady = () => {\n        if (animation) {\n          animation.run(\n            newNode[2],\n            n.map((n2) => n2[2])\n          );\n        } else {\n          n.forEach((oldNode) => oldNode[3]?.onAnimationFinished?.(true));\n        }\n      };\n      n.forEach((prevNode) => (prevNode[3].onReady = () => null));\n      return [...n, newNode];\n    });\n  }, [newNode]);\n  return (\n    <>\n      {[...nodes].reverse().map((n, idx) => (\n        <div key={n[0]}>{n[1]}</div>\n      ))}\n    </>\n  );\n}\n\nexport default function ExpoImage({\n  source,\n  placeholder,\n  contentFit,\n  contentPosition,\n  onLoad,\n  transition,\n  onError,\n  responsivePolicy,\n  onLoadEnd,\n  priority,\n  ...props\n}: ImageNativeProps) {\n  const { aspectRatio, backgroundColor, transform, borderColor, ...style } = props.style ?? {};\n  const { containerRef, source: selectedSource } = useSourceSelection(source, responsivePolicy);\n  const animation =\n    (transition?.duration || -1) > 0 ? getAnimatorFromClass(transition?.effect || null) : null;\n  return (\n    <div\n      ref={containerRef}\n      style={{\n        aspectRatio: String(aspectRatio),\n        backgroundColor: backgroundColor?.toString(),\n        transform: transform?.toString(),\n        borderColor: borderColor?.toString(),\n        ...style,\n        overflow: 'hidden',\n        position: 'relative',\n      }}>\n      <style>\n        {`\n        .cross-dissolve {\n          transition-property: opacity;\n          animation-fill-mode: forwards;\n        }\n        .cross-dissolve-start:not(.transitioning) {\n          opacity: 0;\n        }\n        .cross-dissolve-active {\n          opacity: 1;\n        }\n        .cross-dissolve-end {\n          opacity: 0;\n        }\n        .flip-from-top {\n          transition-property: transform;\n          animation-fill-mode: forwards;\n          transform-origin: top;\n        }\n        .flip-from-top-start:not(.transitioning) {\n          transform: rotateX(90deg);\n        }\n        .flip-from-top-active {\n          transform: rotateX(0);\n        }\n        .flip-from-top-end {\n          transform: rotateX(-90deg);\n        }\n          `}\n      </style>\n      <AnimationManager\n        animation={animation}\n        initial={\n          placeholder?.[0]?.uri\n            ? [\n                placeholder?.[0]?.uri || '',\n                ({ onAnimationFinished, ref }) => (\n                  <Image\n                    ref={ref}\n                    source={placeholder?.[0]}\n                    style={{\n                      objectFit: 'scale-down',\n                    }}\n                    events={{\n                      onTransitionEnd: [onAnimationFinished],\n                    }}\n                    contentPosition={{ left: '50%', top: '50%' }}\n                    blurhashContentPosition={contentPosition}\n                    blurhashStyle={{\n                      objectFit: contentFit,\n                    }}\n                  />\n                ),\n              ]\n            : null\n        }>\n        {[\n          (selectedSource as any)?.uri,\n          ({ onAnimationFinished, onReady, ref, onMount }) => (\n            <Image\n              ref={ref}\n              source={selectedSource || placeholder?.[0]}\n              events={{\n                onError: [onErrorAdapter(onError), onLoadEnd],\n                onLoad: [onLoadAdapter(onLoad), onLoadEnd, onReady],\n                onMount: [onMount],\n                onTransitionEnd: [onAnimationFinished],\n              }}\n              style={{\n                objectFit: selectedSource ? contentFit : 'scale-down',\n                transitionDuration: `${transition?.duration || 0}ms`,\n              }}\n              priority={priority}\n              contentPosition={selectedSource ? contentPosition : { top: '50%', left: '50%' }}\n            />\n          ),\n        ]}\n      </AnimationManager>\n    </div>\n  );\n}\n"]}